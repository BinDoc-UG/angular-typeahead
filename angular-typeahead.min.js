angular.module("siyfion.sfTypeahead",[]).directive("sfTypeahead",function(){return{restrict:"AC",require:"?ngModel",scope:{options:"=",datasets:"=",suggestionKey:"@"},link:function(a,b,c,d){function e(){if(k)b.typeahead(a.options,a.datasets),k=!1;else{var c=b.val();b.typeahead("destroy"),b.typeahead(a.options,a.datasets),d.$setViewValue(c),b.triggerHandler("typeahead:opened")}}function f(a,b){var c=-1;return angular.forEach(a,function(a,d){return angular.equals(b,a)?void(c=d):void 0}),c>=0}function g(b,c,e){a.$apply(function(){var b=angular.isDefined(a.suggestionKey)?c[a.suggestionKey]:c;d.$setViewValue(b)})}function h(a){var b=[];for(var c in a)0===c.indexOf("typeahead:")&&b.push(c.slice(2));return b.join(" ")}var i=a.options||{},j=(angular.isArray(a.datasets)?a.datasets:[a.datasets])||[],k=!0;e(),a.$watch("options",e),angular.isArray(a.datasets)?a.$watchCollection("datasets",e):a.$watch("datasets",e),d.$parsers.push(function(a){if(angular.isObject(d.$modelValue)&&a===b.typeahead("val"))return d.$modelValue;var c=angular.isObject(a);return i.editable===!1?(d.$setValidity("typeahead",c),c?a:void 0):a}),d.$formatters.push(function(c){if(angular.isObject(c)){var e=!1;return $.each(j,function(g,h){function k(h){var k=f(h,c);k?(d.$setViewValue(c),e=!0):d.$setViewValue(i.editable===!1?void 0:c),(e||g===j.length-1)&&setTimeout(function(){a.$apply(function(){b.typeahead("val",n)})},0)}var l=h.source,m=h.displayKey||"value",n=(angular.isFunction(m)?m(c):c[m])||"";return e?!1:n?void l(n,k):void k([])}),""}return null==c&&b.typeahead("val",null),c}),b.bind(h(b[0]),function(b,c,d){var e=["typeahead:selected","typeahead:autocompleted"];e.indexOf(b.type)>0&&g(b,c,d),a.$emit(b.type,b,c,d)})}}});